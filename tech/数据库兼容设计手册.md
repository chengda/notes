# 数据库兼容设计手册
## 1. 目标
兼容以下数据库

* Postgresql     10以上
* MySql            8以上
* Oracle            12c以上

## 2. 兼容方案
### 2.1. 表名和字段名长度
各种数据库对表名和字段名的最大长度有不同的限制，以下是三种数据库的默认值：

| 数据库类型 | 表名 | 字段名 |
| :----------- | :---- | :------ |
| Postgresql | 63    | 63       |
| MySql        | 64    | 64       |
| Oracle       | 30    | 30       |

虽然有的数据库支持修改这个限制值，但为了更好的兼容，要求表名和字段名长度不超过30个字符。

### 2.2. VARCHAR类型字段的最大长度
| 数据库类型 | 类型         | 最大长度 | 单位 | 字符集                                                   | 备注                                                                                                                                                                                                      |
| :----------- | :---------- | :--------- | :---- | :------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| Postgresql | varchar     | 1G          | 字符 | UTF8                                                     | varchar(1)可以存下一个汉字                                                                                                                                                                    |
| MySql        | varchar     | 16383     | 字符 | utf8mb4                                                | varchar(1)可以存下一个汉子                                                                                                                                                                    |
| Oracle       | varchar2   | 4000      | 字节 | SIMPLIFIED CHINESE_CHINA.AL32UTF8 | varchar2(3)才能存下一个汉字                                                                                                                                                                  |
| Oracle       | nvarchar2 | 2000      | 字符 | SIMPLIFIED CHINESE_CHINA.AL32UTF8 | nvarchar2(1)可以存下一个汉字，但是最多可以存1333个汉字，所以如果内容有中文的话，长度超过1333有可能实际存储长度达不到设置的长度 |

要求设计时varchar类型字段长度不得超过1000。

### 2.3. NULL和空字符串
| 数据库类型 |                                   说明                                    |
| ----------- | ------------------------------------------------------ |
| Postgresql | 空字符串不等于NULL，非空字段**允许**存空字符串 |
| MySql        | 空字符串不等于NULL，非空字段**允许**存空字符串 |
| Oracle       | 空字符串等于NULL，非空字段**不允许**存空字符串 |

为确保兼容，非空字段**不允许**存空字符串。


### 2.4. delete表别名使用规范
|  数据库类型   |                                说明                                |
| -------------- | ------------------------------------------------- |
| Postgresql     | delete from table1 t where t.column1='abc'   |
| MySql 8.0.16 | delete from table1 t where t.column1='abc'   |
| MySql 8.0.15 | delete t from table1 t where t.column1='abc' |
| Oracle           | delete from table1 t where t.column1='abc'   |

为兼容MySql（<=8.0.15），需要对使用别名的delete语句进行适配。

* 另外注意，MySql支持多表删除，但Postgresql和Oracle不支持，所以规定**不允许**使用多表删除语句。

### 2.5. 日期和时间
#### Date
| 数据库类型 | 是否支持 |                                                     写入格式                                                     |                                     值域                                     |             说明             |
| ----------- | --------- | ----------------------------------------------------------------------------------- | -------------------------------------------------------- | ---------------------- |
| Postgresql | 支持       | '2019-05-15' 或者 to_date('2019-12-01','yyyy-mm-dd')                                   | 4713 BC	至   5874897 AD                                        | 公元前必须用to_date |
| MySql        | 支持       | '2019-05-15' 或者 str_to_date('2019-12-01','%Y-%m-%d')                               | '1000-01-01'  至 '9999-12-31'                                   |                                 |
| Oracle       | 支持       | to_date('2019-12-01','yyyy-mm-dd') 、to_date('-1019-12-21','syyyy-mm-dd') | -4712(4713 BC)年1月1日0点 至 9999年12月31日24点 |                                 |

#### Time(n)
| 数据库类型 | 是否支持 |                    写入格式                    |                             值域                              |  说明  |
| ----------- | --------- | ------------------------------------ | ---------------------------------------------- | ------ |
| Postgresql | 支持       | '12:05:15'或者make_time(12,5,15) | 00:00:00	至 24:00:00                                | n无效 |
| MySql        | 支持       |                                                    | '-838:59:59.000000' to '838:59:59.000000'. |          |
| Oracle       | 不支持    | --                                                   | --                                                                 | --       |
#### Timestamp(n)
| 数据库类型 | 是否支持 | 写入格式 |                                         值域                                         | 说明 |
| ----------- | --------- | --------- | -------------------------------------------------------------- | ----- |
| Postgresql | 支持       |               | 4713 BC 至 294276 AD                                                     |        |
| MySql        | 支持       |               | '1970-01-01 00:00:01' UTC to '2038-01-19 03:14:07' UTC. |        |
| Oracle       | 支持       |               |                                                                                        |        |
#### Datetime(n)
| 数据库类型 | 是否支持 | 写入格式 |                                  值域                                  | 说明 |
| ----------- | --------- | --------- | --------------------------------------------------- | ----- |
| Postgresql | 不支持    | --           | --                                                                      | --     |
| MySql        | 支持       |               | '1000-01-01 00:00:00' to '9999-12-31 23:59:59'. |        |
| Oracle       | 不支持    |               |                                                                          |        |
